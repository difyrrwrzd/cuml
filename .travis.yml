# Copyright (c) 2018, NVIDIA CORPORATION.

dist: trusty
sudo: required
language: python

branches:
    only:
        - master
env:
  global:
  - secure: "oJ61mXPowJ4rKHam5oW0xvksJ8TyTYokV32xaIoTlN3NpGSvmRXRSX7d2hs7Eam1T6aJbUfrCQcRQ0pSnSMOAUjXf6hmcrnMJDW0lKCx4wUn99nVQWjDBvczvFbDtYb7yKpFFlttiSPievszWOlpy+Wg+EfpZiqWjJa3/qR+5VjY1KY9hwoc3alLx1PQqCmm3XVn8L3wNYVjvOfWE9mTy0P8sYUN5SfGGNxWHZFDt7HNRQj6h+pAA1sJJ14Ndxlrw1s/OkCNurjF8rH/OIaY/N8e4B1rNUI0TG4/HIvnVcFPSCps6zDeUGjZTAZ/a3QeeRT+nQLQFoWUBmIZ49J6FKcry4Y4eaqfqzS87ikSnejyXZf7qJoK9kLCHmmxAX45SvnQ49sm3XX4c2t7HbK3e3NdzBrZEn1QbcLrw2V5Q1+x4P6oDKC+ZGkXWFvwluldS5FcFmLiSzZLJeGyxVBSRi8dgdZoH4NjzUc/VF41kV21c1XGrT+ZHk34papxHWLSWLzsHcZtK278SUMMmtJTg1vIyMtNIt4fAE9FhJP8B96Fv5i521MxU0BD1SpS65/2dM1kWspO1nqsIz+y8iIf/e7KSmMTaxlcF4JVkuMCjovmsCDItL3F5lXl7iJozH/YoRz2Hgez7EyKnuSyiXT6n5b/MSpQ8SnHPyBjCJOAXoI="


matrix:
  include:
    - env: CUDA=9.2.148_396.37 PYTHON=3.5 LABEL_MAIN=1 BUILD_CUML=1
    - env: CUDA=9.2.148_396.37 PYTHON=3.6 LABEL_MAIN=1
    - env: CUDA=10.0.130_410.48 PYTHON=3.5 BUILD_CUML=1
    - env: CUDA=10.0.130_410.48 PYTHON=3.6

before_install:
  # install build environment for libgdf
  - source ./travisci/install-env.sh
  # install miniconda
  - travis_retry wget --progress=dot:mega https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
  - chmod +x miniconda.sh
  - ./miniconda.sh -b
  - export PATH=$HOME/miniconda3/bin:$PATH

install:
  # check
  - conda --version
  # install conda build
  - conda install conda-build anaconda-client flake8 conda-verify cmake=3.11.* --yes
script:
  # Activate root environment for cmake
  - source activate root
  # check conda versions
  - conda list
  # build cuML
  - source ./travisci/build_cuml.sh
  - flake8

after_success:
  # upload cuML
  - source ./travisci/upload-anaconda.sh
